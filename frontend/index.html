<!-- This file defines the structure and content of your application's user interface. 
 It's written in HTML (HyperText Markup Language). 
 It contains no logic, only a description of what should be on the page. -->

<!DOCTYPE html>
<html>
<head>  <!-- The 'head' contains meta-information about the page. -->
    <meta charset="UTF-8">
    <title>BoviTrack - Livestock Management</title> <!-- The text that appears in the window's title bar. -->
    <link rel="stylesheet" href="./node_modules/ag-grid-community/styles/ag-theme-quartz.css"> <!-- The first one loads the styles for our data grid theme. -->
    <link rel="stylesheet" href="styles.css"> <!-- The second one loads our own custom styles. -->
</head>

<body> <!-- The 'body' contains all the visible content of the page. -->

    <!-- This header will be our permanent navigation bar -->
    <header class="main-header"> <!-- This is our top navigation bar. -->
        <div class="header-left">
            <span class="logo">BoviTrack</span> 
            <div class="farm-selector">
                <label for="farm-select" data-translate="current_farm">Current Farm:</label>
                <!-- The farm dropdown will be populated by JavaScript -->
                <select id="farm-select" name="farms"></select>
                <button id="add-farm-btn" class="action-button" title="Add New Farm">+</button>
                <button id="rename-farm-btn" class="action-button" title="Rename Selected Farm">üñâ</button>
                <button id="delete-farm-btn" class="action-button btn-danger" title="Delete Selected Farm">üóëÔ∏è</button> 
            </div>
        </div>
        <nav class="main-nav">
            <ul>
                <!-- Active Stock Menu -->
                <li><a href="#" class="nav-link active" data-page="page-active-stock" data-translate="active_stock">Active Stock</a></li>
                <!-- Operations Menu -->
                <li class="has-dropdown dropdown-align-center">
                    <a href="#" data-translate="operations">Operations</a>
                    <ul class="dropdown">
                        <li><a href="#" class="nav-link" data-page="page-operations-purchases" data-translate="purchases">Purchases</a></li>
                        <li><a href="#" class="nav-link" data-page="page-operations-sales" data-translate="sales">Sales</a></li>
                        <li><a href="#" class="nav-link" data-page="page-operations-weightings" data-translate="weightings">Weightings</a></li>
                        <li><a href="#" class="nav-link" data-page="page-operations-loc-change" data-translate="location_changes">Location Changes</a></li>
                        <li><a href="#" class="nav-link" data-page="page-operations-diet-log" data-translate="diet_logs">Diet Logs</a></li>
                        <li><a href="#" class="nav-link" data-page="page-operations-sanitary" data-translate="sanitary_protocols">Sanitary Protocols</a></li>
                        <li><a href="#" class="nav-link" data-page="page-operations-death" data-translate="deaths">Deaths</a></li>
                    </ul>
                </li>
                <!-- Farm Setup Menu -->
                <li class="has-dropdown dropdown-align-center">
                    <a href="#" data-translate="farm">Farm</a>
                    <ul class="dropdown">
                        <li><a href="#" class="nav-link" data-page="page-locations" data-translate="locations">Locations</a></li>
                        <li><a href="#" class="nav-link" data-page="page-lots" data-translate="lots">Lots</a></li>
                    </ul>
                </li>
                <!-- Lookup Menu -->
                <li class="has-dropdown dropdown-align-right">
                    <a href="#" data-translate="lookup">Lookup</a>
                    <ul class="dropdown">
                        <li><a href="#" class="nav-link" data-page="page-consult-animal" data-translate="search_animal">Search Animal</a></li>
                    </ul>
                </li>
                <li><a href="#" class="nav-link" data-page="page-settings">‚öôÔ∏è</a></li>
            </ul>
        </nav>
    </header>

    <main id="app-content"> </main>
    
<!-- ==========================================================================
    Modals
    ========================================================================== -->
    <!-- ADD FARM MODAL -->
    <div id="add-farm-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="register_new_farm">Register New Farm</h3>
            <form id="add-farm-form">
                <label for="new-farm-name" data-translate="farm_name">Farm Name:</label>
                <input type="text" id="new-farm-name" required>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_farm">Save Farm</button>
                    <button type="button" id="cancel-add-farm" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename Farm Modal -->
    <div id="rename-farm-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="rename_farm">Rename Farm</h3>
            <form id="rename-farm-form">
                <label for="rename-farm-name" data-translate="new_farm_name">New Farm Name:</label>
                <input type="text" id="rename-farm-name" required>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_changes">Save Changes</button>
                    <button type="button" id="cancel-rename-farm" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>

        <!-- NEW: Delete Farm Confirmation Modal -->
    <div id="delete-farm-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="confirm_deletion">Confirm Deletion</h3>
            <p class="warning-text" data-translate="confirm_delete_farm_message_1">Are you sure you want to delete the farm "<strong id="farm-name-to-delete"></strong>"?</p>
            <p class="warning-text" data-translate="confirm_delete_farm_message_2"><strong>This action is permanent and cannot be undone.</strong> All animals, sales, weightings, and other associated data for this farm will be permanently deleted.</p>
            <div class="modal-actions">
                <!-- We will use a form here to listen for the submit event -->
                <form id="delete-farm-form">
                    <button type="button" id="cancel-delete-farm" data-translate="cancel">Cancel</button>
                    <button type="submit" class="btn-danger" data-translate="confirm_delete">Confirm Delete</button>
                </form>
            </div>
        </div>
    </div>
    
     <!-- ADD PURCHASE MODAL -->
    <div id="add-purchase-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="add_new_purchase">Add New Purchase</h3>
            <form id="add-purchase-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="purchase-ear-tag" data-translate="ear_tag">Ear Tag</label>
                        <input type="text" id="purchase-ear-tag" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-lot" data-translate="lot">Lot</label>
                        <input type="text" id="purchase-lot" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-entry-date" data-translate="entry_date">Entry Date</label>
                        <input type="date" id="purchase-entry-date" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-entry-age" data-translate="entry_age_months">Entry Age (Months)</label>
                        <input type="number" step="0.1" id="purchase-entry-age" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-entry-weight" data-translate="entry_weight_kg">Entry Weight (kg)</label>
                        <input type="number" step="0.01" id="purchase-entry-weight" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-sex" data-translate="sex">Sex</label>
                        <select id="purchase-sex" required>
                            <option value="M" data-translate="male">Male</option>
                            <option value="F" data-translate="female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="purchase-race" data-translate="race_optional">Race (Optional)</label>
                        <input type="text" id="purchase-race">
                    </div>
                    <div class="form-group">
                        <label for="purchase-price" data-translate="purchase_price_optional">Purchase Price (Optional)</label>
                        <input type="number" step="0.01" id="purchase-price">
                    </div>
                    <div class="form-group form-group-full">
                        <label for="purchase-location" data-translate="initial_location">Initial Location</label>
                        <select id="purchase-location" required>
                            <!-- Locations will be populated by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="purchase-diet-type" data-translate="initial_diet_type">Initial Diet Type (Optional)</label>
                        <input type="text" id="purchase-diet-type">
                    </div>
                    <div class="form-group">
                        <label for="purchase-diet-intake" data-translate="initial_diet_intake_percentage">Initial Diet Intake (%)</label>
                        <input type="number" step="0.1" id="purchase-diet-intake">
                    </div>
                    <!-- NEW: Sanitary Protocols Section -->
                    <div class="sub-form-section">
                        <h4 data-translate="add_sanitary_protocols_optional">Add Sanitary Protocols (Optional)</h4>
                        
                        <!-- This is where the list of added protocols will appear -->
                        <ul id="protocols-list" class="dynamic-list">
                            <!-- Items will be added here by JavaScript -->
                        </ul>

                        <!-- Container for ONLY the input fields -->
                        <div class="sub-form-inputs">
                            <input type="date" id="protocol-date" data-translate-placeholder="date_placeholder">
                            <input type="text" id="protocol-type" data-translate-placeholder="protocol_type_placeholder">
                            <input type="text" id="protocol-product" data-translate-placeholder="product_name_placeholder">
                            <input type="text" id="protocol-dosage" data-translate-placeholder="dosage_placeholder">
                            <input type="text" id="protocol-invoice" data-translate-placeholder="invoice_number_placeholder">
                        </div>

                        <!-- **** NEW **** Container for ONLY the action buttons -->
                        <div class="sub-form-actions">
                            <button type="button" id="add-protocol-btn" class="button-primary" data-translate="add_protocol">Add Protocol</button>
                            <button type="button" id="clear-protocols-btn" class="button-secondary btn-danger" data-translate="clear_all">Clear All</button>
                        </div>
                    </div>  
                    
                </div>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_purchase">Save Purchase</button>
                    <button type="button" id="cancel-add-purchase" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ADD SALE MODAL -->
    <div id="add-sale-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="add_new_sale">Add New Sale</h3>
            <form id="add-sale-form">
                <!-- Animal Search Section -->
                <div class="form-group form-group-full">
                    <label for="sale-animal-search-eartag" data-translate="search_animal_to_sell">Search Animal to Sell by Ear Tag</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="sale-animal-search-eartag" required>
                        <button type="button" id="search-animal-btn" class="button-primary" data-translate="search">Search</button>
                    </div>
                    <div id="search-animal-result" class="animal-search-results-container"></div>

                </div>

                <!-- Sale Details Section -->
                <div class="form-grid" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                    <div class="form-group">
                        <label for="sale-date" data-translate="sale_date">Sale Date</label>
                        <input type="date" id="sale-date" required>
                   </div>
                     <div class="form-group">
                        <label for="sale-exit-weight" data-translate="exit_weight_kg">Exit Weight (kg)</label>
                        <input type="number" step="0.01" id="sale-exit-weight" required>
                    </div>
                    <div class="form-group form-group-full">
                        <label for="sale-price" data-translate="sale_price">Sale Price</label>
                       <input type="number" step="0.01" id="sale-price" required>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_sale">Save Sale</button>
                   <button type="button" id="cancel-add-sale" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
<!-- ADD WEIGHTING MODAL -->
    <div id="add-weighting-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="add_new_weighting">Add New Weighting</h3>
            <form id="add-weighting-form">
                <!-- Animal Search Section -->
                <div class="form-group form-group-full">
                    <label for="weighting-animal-search-eartag" data-translate="search_animal_to_weigh">Search Animal to Weigh by Ear Tag</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="weighting-animal-search-eartag" required>
                        <button type="button" id="weighting-search-animal-btn" class="button-primary" data-translate="search">Search</button>
                    </div>
                    <div id="weighting-search-animal-result" class="animal-search-results-container"></div>
                </div>

                <!-- Weighting Details Section -->
                <div class="form-grid" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                    <div class="form-group">
                        <label for="weighting-date" data-translate="date">Date</label>
                        <input type="date" id="weighting-date" required>
                    </div>
                    <div class="form-group">
                        <label for="weighting-weight-kg" data-translate="weighting_kg">Weight (kg)</label>
                        <input type="number" step="0.01" id="weighting-weight-kg" required>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_weighting">Save Weighting</button>
                    <button type="button" id="cancel-add-weighting" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    <!-- ADD LOCATION CHANGE MODAL -->
    <div id="add-location-change-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="add_new_location_change">Add New Location Change</h3>
            <form id="add-location-change-form">
                <!-- Animal Search Section -->
                <div class="form-group form-group-full">
                    <label for="location-change-animal-search-eartag" data-translate="search_animal_for_loc_change">Search Animal to Move by Ear Tag</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="location-change-animal-search-eartag" required>
                        <button type="button" id="location-change-search-animal-btn" class="button-primary" data-translate="search">Search</button>
                    </div>
                    <div id="location-change-search-animal-result" class="animal-search-results-container"></div>
                </div>

                <!-- Details Section -->
                <div class="form-grid" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                    <div class="form-group">
                        <label for="location-change-date" data-translate="date">Date</label>
                        <input type="date" id="location-change-date" required>
                    </div>
                    <div class="form-group">
                        <label for="new-location-select" data-translate="new_location">New Location</label>
                        <select id="new-location-select" required></select>
                    </div>
                    <div class="form-group form-group-full">
                        <label for="location-change-weight-kg" data-translate="optional_weight_kg">Weight (kg, Optional)</label>
                        <input type="number" step="0.01" id="location-change-weight-kg">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_location_change">Save Location Change</button>
                    <button type="button" id="cancel-add-location-change" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
     <!-- ADD DIET LOG MODAL -->
    <div id="add-diet-log-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="add_new_diet_log">Add New Diet Log</h3>
            <form id="add-diet-log-form">
                <!-- Animal Search Section -->
                <div class="form-group form-group-full">
                    <label for="diet-log-animal-search-eartag" data-translate="search_animal_for_diet_log">Search Animal to Update Diet by Ear Tag</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="diet-log-animal-search-eartag" required>
                        <button type="button" id="diet-log-search-animal-btn" class="button-primary" data-translate="search">Search</button>
                    </div>
                    <div id="diet-log-search-animal-result" class="animal-search-results-container"></div>
                </div>

                <!-- Details Section -->
                <div class="form-grid" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                    <div class="form-group">
                        <label for="diet-log-date" data-translate="date">Date</label>
                        <input type="date" id="diet-log-date" required>
                    </div>
                    <div class="form-group">
                        <label for="new-diet-type" data-translate="new_diet_type">New Diet Type</label>
                        <input type="text" id="new-diet-type" required>
                    </div>
                    <div class="form-group">
                        <label for="new-diet-intake" data-translate="diet_intake">Daily Intake (%)</label>
                        <input type="number" step="0.1" id="new-diet-intake">
                    </div>
                    <div class="form-group">
                        <label for="diet-log-weight-kg" data-translate="optional_weight_kg">Weight (kg, Optional)</label>
                        <input type="number" step="0.01" id="diet-log-weight-kg">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_diet_log">Save Diet Log</button>
                    <button type="button" id="cancel-add-diet-log" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    <!-- ADD SANITARY PROTOCOL MODAL -->
    <div id="add-sanitary-protocol-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="add_new_sanitary_protocol">Add New Sanitary Protocol</h3>
            <form id="add-sanitary-protocol-form">
                <!-- Animal Search Section -->
                <div class="form-group form-group-full">
                    <label for="sp-animal-search-eartag" data-translate="search_animal_for_protocol">Search Animal for Protocol by Ear Tag</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="sp-animal-search-eartag" required>
                        <button type="button" id="sp-search-animal-btn" class="button-primary" data-translate="search">Search</button>
                    </div>
                    <div id="sp-search-animal-result" class="animal-search-results-container"></div>
                </div>

                <!-- Protocol Sub-form Section -->
                <div class="sub-form-section" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                    <h4 data-translate="add_sanitary_protocols">Add Sanitary Protocols</h4>
                    <ul id="sp-protocols-list" class="dynamic-list"></ul>
                    <div class="sub-form-inputs">
                        <input type="date" id="sp-protocol-date" data-translate-placeholder="date_placeholder">
                        <input type="text" id="sp-protocol-type" data-translate-placeholder="protocol_type_placeholder">
                        <input type="text" id="sp-protocol-product" data-translate-placeholder="product_name_placeholder">
                        <input type="text" id="sp-protocol-dosage" data-translate-placeholder="dosage_placeholder">
                        <input type="text" id="sp-protocol-invoice" data-translate-placeholder="invoice_number_placeholder">
                    </div>
                    <div class="sub-form-actions">
                        <button type="button" id="sp-add-protocol-btn" class="button-primary" data-translate="add_protocol">Add Protocol</button>
                        <button type="button" id="sp-clear-protocols-btn" class="button-secondary btn-danger" data-translate="clear_all">Clear All</button>
                    </div>
                </div>
                <!-- THE FIX: Optional Weight Field -->
                <div class="form-group form-group-full" style="margin-top: 10px;">
                    <label for="sp-weight-kg" data-translate="optional_weight_kg">Weight (kg, Optional)</label>
                    <input type="number" step="0.01" id="sp-weight-kg">
                </div>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_protocols">Save Protocols</button>
                    <button type="button" id="cancel-add-sanitary-protocol" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    <!-- ADD DEATH MODAL -->
    <div id="add-death-modal" class="modal-backdrop hidden">
        <div class="modal-content">
            <h3 data-translate="add_new_death_record">Add New Death Record</h3>
            <form id="add-death-form">
                <!-- Animal Search Section -->
                <div class="form-group form-group-full">
                    <label for="death-animal-search-eartag" data-translate="search_animal_for_death_record">Search Animal to Record Death by Ear Tag</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="death-animal-search-eartag" required>
                        <button type="button" id="death-search-animal-btn" class="button-primary" data-translate="search">Search</button>
                    </div>
                    <div id="death-search-animal-result" class="animal-search-results-container"></div>
                </div>

                <!-- Details Section -->
                <div class="form-grid" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                    <div class="form-group">
                        <label for="death-date" data-translate="date">Date</label>
                        <input type="date" id="death-date" required>
                    </div>
                    <div class="form-group">
                        <label for="death-cause" data-translate="cause_of_death_optional">Cause of Death (Optional)</label>
                        <input type="text" id="death-cause">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" data-translate="save_death_record">Save Death Record</button>
                    <button type="button" id="cancel-add-death" data-translate="cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    <div id="toast-notification"></div>
    <!-- CRITICAL: This line loads and executes our JavaScript files. -->
    <!-- It is placed at the end of the <body> so that the JavaScript code runs -->
    <!-- AFTER all the HTML elements above it have been created. This ensures -->
    <!-- that getElementById() can find the elements it's looking for. -->
    <script src="./js/translations.js"></script>
    <script src="./js/main-renderer.js"></script>
    <script src="./js/pages/active-stock.js"></script>
    <script src="./js/pages/operations-purchases.js"></script>
    <script src="./js/pages/operations-sales.js"></script>
    <script src="./js/pages/operations-weightings.js"></script>
    <script src="./js/pages/operations-loc-change.js"></script>
    <script src="./js/pages/operations-diet-log.js"></script>
    <script src="./js/pages/operations-sanitary.js"></script>
    <script src="./js/pages/operations-death.js"></script>
    <script src="./js/pages/settings.js"></script>
</body>
</html>